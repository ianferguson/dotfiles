# some help
# http://www.linuxized.com/2010/05/switching-from-gnu-screen-to-tmux/
# http://blog.hawkhost.com/2010/07/02/tmux-â€“-the-terminal-multiplexer-part-2/#modifying-tab-color

## Screenesque stuff #################################################
#screen it up a bit, use C-a not C-b
unbind C-b
set -g prefix "C-a"

#allows screen like sending of C-a a for nested sessions
bind a send-prefix

#allow C-a C-a to switch to last pane
bind "C-a" select-pane -l

#ctrl-a + shift-a to rename tabs
bind "A" command-prompt 'rename-window %%'

#do not constrain all windows in a session to smallest size
setw -g aggressive-resize on

#repack window indexes down towards 1 as windows are removed
set-option -g renumber-windows on

#index from 1, since 0 is way over => there on keyboards
set -g base-index 1

# address vim mode switching delay (http://superuser.com/a/252717/65504)
#do not wait for escape seq
set -s escape-time 0

#maybe make it 256 colors? no idea.
set -g default-terminal screen-256color

#set space and backspace to work like n and p
#use -r to allow repeated triggering in a row
unbind " "
bind -r " " next-window

unbind BSpace
bind -r BSpace previous-window

#add in kill at k
unbind k
bind k "kill-window"

set -g history-limit 32000
## End Screen ########################################################

## Panes ############################################################
# Use vim nav keys to move around pains
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# use ctrl-p esque commands for splits
bind C-v split-window -h
bind C-x split-window

# grey out the background of non-current panes a bit
set -g window-active-style 'bg=black'
set -g window-style 'bg=colour235'

set -g pane-base-index 1
set -g pane-border-status top

# attempt to set pane titles to current running command
# https://github.com/tmux/tmux/issues/733#issuecomment-358632846
set -g pane-border-format '#(ps -t #{pane_tty} -o args= | tail -1)'

## Misc ##############################################################

# http://www.economyofeffort.com/2013/07/29/reattach-to-user-namespace-the-fix-for-your-tmux-in-os-x-woes/
set-option -g default-command "reattach-to-user-namespace -l fish"

# Use vim keybindings in copy mode
setw -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# paste from system clipboard in addition to copying to it
# there has to be a better way to do this!
# from: https://evertpot.com/osx-tmux-vim-copy-paste-clipboard/
bind ] run "reattach-to-user-namespace pbpaste | tmux load-buffer - && tmux paste-buffer"

######################################################################

## Status bar setup and format #######################################
set -g status-position bottom
set -g set-titles on
set -g set-titles-string '#(hostname -s):#I.#P #W #T' # window number,program name,active (or not)

setw -g automatic-rename on

#non-current windows
setw -g window-status-style fg=colour245
setw -g window-status-style bg=colour235
setw -g window-status-format "#[fg=cyan]#F#[fg=colour245](#I #(basename #{pane_current_path})) "

#current window
setw -g window-status-current-style fg=cyan
setw -g window-status-current-style bg=colour235
setw -g window-status-current-format "#F(#I #(basename #{pane_current_path})) "

set -g status-bg colour235
set -g status-fg green

# See here for why the date format string uses doubled '%' chars http://unix.stackexchange.com/a/115812
set -g status-left '#[fg=green][ #(date -u '+%%H:%%M') UTC ]['
set -g status-left-length 24
set -g status-right '#[fg=green]][ #(spotify-current-track | cut -c 1-44) ][ %m/%d %H:%M ]'
set -g status-right-length 64

#message bar
set -g message-command-style "bg=colour235,fg=cyan"

## End Status bar ###################################################

# `+r reloads the configuration, handy
bind r source-file ~/.tmux.conf
